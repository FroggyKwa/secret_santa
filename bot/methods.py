import telegram
from telegram import Update
from telegram.ext import CallbackContext
from db.models import Person, RelationShip


def get_name(update, context):
    name = update.message.text
    if len(name.split()) < 2:
        context.bot.send_message(chat_id=update.effective_chat.id, text='Ð’Ð²ÐµÐ´Ð¸ Ñ„Ð°Ð¼Ð¸Ð»Ð¸ÑŽ Ð¸ Ð¸Ð¼Ñ. ðŸ¤“')
        return 1
    context.bot.send_message(chat_id=update.effective_chat.id,
                             text=f'ÐŸÑ€Ð¸ÑÑ‚Ð½Ð¾ Ð¿Ð¾Ð·Ð½Ð°ÐºÐ¾Ð¼Ð¸Ñ‚ÑŒÑÑ, {name}!\nÐ’Ð²ÐµÐ´Ð¸ /start ÐµÑ‰Ñ‘ Ñ€Ð°Ð·, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ!')
    Person.create(id=update.effective_chat.id, username=update.effective_chat.username, name=name)
    return 0


def start(update: telegram.Update, context: CallbackContext):
    if not Person.select().where(Person.id == update.effective_chat.id).exists():
        context.bot.send_message(chat_id=update.effective_chat.id,
                                 text='ÐšÐ°Ðº Ñ‚ÐµÐ±Ñ Ð·Ð¾Ð²ÑƒÑ‚? (Ð–ÐµÐ»Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ñ„Ð°Ð¼Ð¸Ð»Ð¸ÑŽ Ð¸ Ð¸Ð¼Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ‚Ð²Ð¾Ð¹ ÑÐ°Ð½Ñ‚Ð° Ð·Ð½Ð°Ð», Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ‚ÐµÐ±Ðµ)')
        return 1
    text = f'''ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð¼Ð¾Ð¹ Ð¼Ð½Ð¾Ð³Ð¾ÑƒÐ²Ð°Ð¶Ð°ÐµÐ¼Ñ‹Ð¹ ÑÐ¼Ð¸Ð³Ñ€Ð°Ð½Ñ‚ - {update.effective_chat.full_name}! ðŸ¥¸\nÐ¡Ð¾Ð³Ð»Ð°ÑÐ¸ÑÑŒ, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÑŒ ðŸŽÐ¿Ð¾Ð´Ð°Ñ€ÐºÐ¸ðŸŽ Ð½Ð° ÐÐ¾Ð²Ñ‹Ð¹ Ð³Ð¾Ð´ðŸŽ„ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾, Ð° Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¸Ñ… ÐµÑ‰Ðµ Ð¿Ñ€Ð¸ÑÑ‚Ð½ÐµÐµ. ðŸ˜Š\nÐŸÐ¾ÑÑ‚Ð¾Ð¼Ñƒ Ñ ÑÐ¾Ð·Ð´Ð°Ð½ Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð½Ð°Ð¼, ÑÐ¼Ð¸Ð³Ñ€Ð°Ð½Ñ‚Ð°Ð¼.\n\nÐŸÑ€Ð¸ÐºÐ¾Ð»ÑŒÐ½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð±Ñ‹ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ ðŸŽ…Ñ‚Ð°Ð¹Ð½Ð¾Ð³Ð¾ ÑÐ°Ð½Ñ‚ÑƒðŸŽ…, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð¸ Ð¿Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾ ÑÐ²Ð¾ÐµÐ¼Ñƒ Ð´Ñ€ÑƒÐ³Ñƒ/Ð¿Ð¾Ð´Ñ€ÑƒÐ³Ðµ. ðŸ˜‹\nÐ¡ÐµÐ¹Ñ‡Ð°Ñ Ñ€Ð°ÑÑÐºÐ°Ð¶Ñƒ, ÐºÐ°Ðº ÑÑ‚Ð¾ Ð²ÑÑ‘ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:\n\n1) Ð¢Ñ‹ Ð¿Ð¾ÐºÑƒÐ¿Ð°ÐµÑˆÑŒ ÐºÐ°ÐºÑƒÑŽ-Ð½Ð¸Ð±ÑƒÐ´ÑŒ ÑˆÑ‚ÑƒÐºÑƒ Ð² Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ñ… 1000 Ñ€ÑƒÐ±Ð»ÐµÐ¹ (Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼Ð° Ð½ÐµÑ‚, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ñ…Ð¾Ñ‚ÑŒ ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´ÐºÑƒ ÐºÑƒÐ¿Ð¸Ñ‚ÑŒ, Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÑŽ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾ Ð½Ðµ Ð¾Ñ‚ ÑÑƒÐ¼Ð¼Ñ‹ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ°, Ð° Ð¾Ñ‚ Ñ„Ð°ÐºÑ‚Ð° Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ° ðŸ˜‹\n\n2) ÐšÐ¾Ð³Ð´Ð° Ñ€ÐµÑˆÐ¸Ð»ÑÑ Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº, Ñ‚Ð¾ Ð¿Ð¸ÑˆÐ¸ Ð¼Ð½Ðµ /get_recipient, Ð¿Ð¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ñ Ð·Ð°Ð¿Ð¸ÑˆÑƒ Ñ‚Ð¾Ð³Ð¾, ÐºÐ¾Ð¼Ñƒ Ñ‚Ñ‹ Ð´Ð°Ñ€Ð¸ÑˆÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð¸ Ñ‚Ñ‹, Ð¼Ð¾Ð¹ Ð´Ð¾Ñ€Ð¾Ð³Ð¾Ð¹ Ð´Ñ€ÑƒÐ³, Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±ÑƒÐ´ÐµÑˆÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð´Ð¾ 31 Ð´ÐµÐºÐ°Ð±Ñ€ÑðŸŽ„ (Ð¸Ð»Ð¸ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð·Ð¶Ðµ, ÐµÑÐ»Ð¸ Ñ‚ÐµÐ±Ñ ÑÐµÐ¹Ñ‡Ð°Ñ Ð½ÐµÑ‚ Ð² ÐŸÑ€Ð¸Ð¼Ð¾Ñ€ÑÐºÐ¾Ð¼ ÐºÑ€Ð°Ðµ)\n\n3) Ð•ÑÐ»Ð¸ Ñ‚Ñ‹ Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÑƒ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ñ‹Ð¿Ð°Ð» Ñ‚ÐµÐ±Ðµ Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð½Ð¾, Ñ‚Ð¾, Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¾Ñ‚Ð±Ñ€Ð¾ÑÑŒ Ð²ÑÐµ Ð½ÐµÑ…Ð¾Ñ€Ð¾ÑˆÐ¸Ðµ Ð¼Ñ‹ÑÐ»Ð¸ Ð¿Ñ€Ð¾ ÑÑ‚Ð¾Ð³Ð¾ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°, Ñ‚Ñ‹ Ð´ÐµÐ´ Ð¼Ð¾Ñ€Ð¾Ð· Ð¸ Ñ‚Ñ‹ Ð´Ð°Ñ€Ð¸ÑˆÑŒ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ¸ Ð´Ð°Ð¶Ðµ ÑÐ°Ð¼Ñ‹Ð¼ Ð½ÐµÐ³Ð¾Ð´ÑÐ¹ÑÐºÐ¸Ð¼ Ð½ÐµÐ³Ð¾Ð´ÑÑÐ¼ðŸ¤ª. ÐŸÐ¾Ð´Ð°Ñ€Ð¸ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ Ð¸ Ñ‚ÐµÐ±Ðµ Ð²ÐµÑ€Ð½Ñ‘Ñ‚ÑÑ Ð²Ð´Ð²Ð¾Ð¹Ð½Ðµ ðŸ’–\n\n4) ÐšÐ¾Ð½ÐµÑ‡Ð½Ð¾, ÐµÑÐ»Ð¸ Ñ‚ÐµÐ±Ðµ Ð»ÐµÐ½ÑŒ Ð¸Ð»Ð¸ Ð½Ð¸ÐºÐ°Ðº Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ÑÑ ÐºÑƒÐ¿Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº, Ñ‚Ð¾ Ñ‚Ñ‹ Ð²Ð¾Ð»ÐµÐ½ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ, Ð½Ð¾ Ð¿Ð¾Ð´ÑƒÐ¼Ð°Ð¹ ÑÐ°Ð¼, ÐµÑÐ»Ð¸ Ð½Ðµ Ð¿Ð¾Ð´Ð°Ñ€Ð¸ÑˆÑŒ Ñ‚Ñ‹, Ñ‚Ð¾ Ð½Ð¸ÐºÑ‚Ð¾ Ð½Ðµ Ð¿Ð¾Ð´Ð°Ñ€Ð¸Ñ‚, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾Ñ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº ÑƒÐ¶Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚, ÐºÐ°Ðº Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÑŒ (Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð½ÐµÐ»ÑŒÐ·Ñ, Ð² ÑÑ‚Ð¾Ð¼ Ð²ÐµÑÑŒ ÑÐ¼Ñ‹ÑÐ»). Ð Ñ‚Ð°ÐºÐ¸Ð¼ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ¾Ð¼, Ð¾ÑÑ‚Ð°Ð²ÑˆÐ¸Ð¼ÑÑ Ð±ÐµÐ· Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ°, Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð±Ñ‹Ñ‚ÑŒ Ð¸ Ñ‚Ñ‹, Ð¼Ð¾Ð¹ Ð´Ñ€ÑƒÐ³, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¿Ð¾ÑÑ‚Ð°Ñ€Ð°Ð¹ÑÑ Ð¸ Ð½Ðµ Ð½Ð°ÐºÐ¾ÑÑÑ‡ÑŒ!ðŸ˜¢\n\nÐÐ°Ð¿Ð¸ÑˆÐ¸ /help, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð·Ð½Ð°ÐºÐ¾Ð¼Ð¸Ñ‚ÑŒÑÑ ÑÐ¾ Ð²ÑÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»Ð¾Ð¼ '''
    context.bot.send_message(chat_id=update.effective_chat.id, text=text)
    return -1


def end(update, context):
    return -1


def get_info(update: telegram.Update, context: CallbackContext):
    context.bot.send_message(chat_id=update.effective_chat.id,
                             text='ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð°:\n\n/start - ÑÑ‚Ð°Ñ€Ñ‚ÑƒÐµÑ‚ Ð±Ð¾Ñ‚Ð° Ð¸ Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°ÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°;\n\n/help - Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´; \n\n/get_recipient - Ð´ÐµÐ»Ð°ÐµÑ‚ Ñ‚ÐµÐ±Ñ Ð¡Ð°Ð½Ñ‚Ð¾Ð¹ Ð¸ Ð´Ð°Ñ‘Ñ‚ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ñƒ-Ñ‚Ð¾ Ð¸Ð· ÑÐ¼Ð¸Ð³Ñ€Ð°Ð½Ñ‚Ð¾Ð² ÑƒÐ»Ñ‹Ð±ÐºÑƒ \n\n/sent - Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°ÐµÑ‚ Ð¡Ð°Ð½Ñ‚Ð°, ÐºÐ¾Ð³Ð´Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº. Ð­Ñ‚Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¿Ñ€Ð¸ÑˆÐ»Ñ‘Ñ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÑŽ, Ñ‡Ñ‚Ð¾ ÐµÐ¼Ñƒ ÑÑ‚Ð¾Ð¸Ñ‚ Ð² Ð±Ð»Ð¸Ð·Ð¶Ð°Ð¹ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð¶Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº.\n\n/received - Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ°, Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÑ Ð¡Ð°Ð½Ñ‚Ñƒ Ð¾Ð± ÑÑ‚Ð¾Ð¼ Ð¸ Ð¿Ð¾Ð²Ñ‹ÑˆÐ°Ñ ÐºÐ°Ñ€Ð¼Ñƒ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÐµÐ»Ñ.')


def get_recipient(update: telegram.Update, context: CallbackContext):
    from random import choice
    if not Person.select().where(Person.id == update.effective_chat.id).exists():
        return
    donor = Person.get_by_id(update.effective_chat.id)
    if RelationShip.select().where(RelationShip.donor == donor):
        context.bot.send_message(chat_id=update.effective_chat.id,
                                 text='Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¡Ð°Ð½Ñ‚Ð° Ð³Ð¾Ñ€Ð´Ð¸Ñ‚ÑÑ Ñ‚Ð²Ð¾ÐµÐ¹ Ð´Ð¾Ð±Ñ€Ð¾Ñ‚Ð¾Ð¹ Ð¸ Ð¶ÐµÐ»Ð°Ð½Ð¸ÐµÐ¼ Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ¸ Ð²ÑÐµÐ¼, Ð½Ð¾ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð´Ð°Ñ€Ð¸ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ð¾Ð¼Ñƒ Ñ‚ÐµÐ±Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÑŽ, Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¼Ñ‹ ÑƒÐ¶Ðµ Ð¿Ð¾Ð´ÑƒÐ¼Ð°ÐµÐ¼, ÑÐ¼Ð¾Ð¶ÐµÑˆÑŒ Ð»Ð¸ Ñ‚Ñ‹ Ð¿Ð¾Ð´Ð½ÑÑ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ñƒ-Ð½Ð¸Ð±ÑƒÐ´ÑŒ ÐµÑ‰Ðµ! (Ð¿Ð¾Ð´Ð°Ñ€ÐºÐ¾Ð² Ð²ÐµÐ´ÑŒ Ð¼Ð½Ð¾Ð³Ð¾ Ð½Ðµ Ð±Ñ‹Ð²Ð°ÐµÑ‚)ðŸŽ')
        context.bot.send_message(chat_id=update.effective_chat.id,
                                 text=f'ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÑŽ, Ñ‚Ð²Ð¾Ð¹ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ - {RelationShip.select().where(RelationShip.donor == donor)[0].recipient.name}')
        return
    not_used = list(Person.select().where((Person.is_recipient == False) & (Person.id != donor.id)))
    if not not_used:
        context.bot.send_message(chat_id=update.effective_chat.id,
                                 text='Ðš ÑÐ¾Ð¶Ð°Ð»ÐµÐ½Ð¸ÑŽ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚.\n\n Ð”Ð¾Ñ€Ð¾Ð³Ð¾Ð¹ Ð´Ñ€ÑƒÐ³, Ñ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÑŽ Ñ‚ÐµÐ±Ðµ Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ Ð²Ð²ÐµÑÑ‚Ð¸ /get_recipient ÑÐ½Ð¾Ð²Ð°. Ð¢ÐµÐ±Ñ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð±ÐµÐ· ÑÐ°Ð½Ñ‚Ñ‹ Ñ Ð²Ð½Ñ‘Ñ. ðŸ˜‡')
        return
    recipient = choice(not_used)
    RelationShip.create(donor=donor, recipient=recipient)
    recipient.is_recipient = True
    recipient.save()
    context.bot.send_message(chat_id=recipient.id,
                             text='Ð”Ð»Ñ Ñ‚ÐµÐ±Ñ Ð½Ð°ÑˆÑ‘Ð»ÑÑ Ñ‚Ð°Ð¹Ð½Ñ‹Ð¹ ÑÐ°Ð½Ñ‚Ð°! ðŸŽ…\n\nÐ¢ÐµÐ¿ÐµÑ€ÑŒ Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /received, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð¸ÑˆÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº, Ñ‚ÐµÐ¼ ÑÐ°Ð¼Ñ‹Ð¼ Ð¿Ð¾Ð²Ñ‹ÑÐ¸Ð² ÐºÐ°Ñ€Ð¼Ñƒ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ Ð¡Ð°Ð½Ñ‚Ñ‹.')
    context.bot.send_message(chat_id=update.effective_chat.id,
                             text=f'ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÑŽ! ÐŸÐ¾ Ð²Ð¾Ð»Ðµ Ð±Ð¾Ð³Ð° Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð° Ñ‚Ñ‹ Ð´Ð°Ñ€Ð¸ÑˆÑŒ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº - {recipient.name}')


def received(update, context):
    if Person.get_by_id(update.effective_chat.id).is_recipient:
        context.bot.send_message(chat_id=update.effective_chat.id,
                                 text='ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÑŽ Ñ Ð½Ð°ÑÑ‚ÑƒÐ¿Ð°ÑŽÑ‰Ð¸Ð¼ Ð½Ð¾Ð²Ñ‹Ð¼ Ð³Ð¾Ð´Ð¾Ð¼! Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ ÑƒÐ´ÐµÐ»Ð¸Ð» Ð²Ñ€ÐµÐ¼Ñ ÑÑ‚Ð¾Ð¹ Ð¸Ð³Ñ€Ðµ, Ð° Ñ‚Ð¾Ñ‚ Ñ„Ð°ÐºÑ‚, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð²ÑÑ‘-Ñ‚Ð°ÐºÐ¸ Ð´Ð¾ÑÑ‚Ð°Ð»ÑÑ Ñ‚ÐµÐ±Ðµ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚, Ñ‡Ñ‚Ð¾ Ð²ÑÑ‘ Ð¿Ñ€Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ð·Ñ€Ñ.\n Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€ÑŽ Ð·Ð° ÑƒÑ‡Ð°ÑÑ‚Ð¸Ðµ.')
        donor = RelationShip.select().where(RelationShip.recipient == Person.get_by_id(update.effective_chat.id))[0].donor
        context.bot.send_message(chat_id=donor.id,
                                 text='Ð¢Ñ‹ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¿Ð¾Ñ‚Ñ€ÑƒÐ´Ð¸Ð»ÑÑ. Ð¢Ð²Ð¾Ð¹ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð±Ñ‹Ð» Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½! Ð£Ð²ÐµÑ€ÐµÐ½, Ñ‡Ñ‚Ð¾ Ñ‚Ð¾Ñ‚, ÐºÐ¾Ð¼Ñƒ Ð´Ð¾ÑÑ‚Ð°Ð»ÑÑ Ñ‚Ð²Ð¾Ð¹ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð¸ÑÐºÑ€ÐµÐ½Ð½Ðµ ÑƒÐ»Ñ‹Ð±Ð°Ð»ÑÑ Ð¸ Ñ€Ð°Ð´Ð¾Ð²Ð°Ð»ÑÑ, Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð² ÐµÐ³Ð¾! Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¿Ñ€Ð¾Ð´ÐµÐ»Ð°Ð½Ð½ÑƒÑŽ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ! :)')
        donor.karma_level += 1 if not donor.karma_level else 0
        donor.save()
    else:
        context.bot.send_message(chat_id=update.effective_chat.id,
                                 text='Ð¢Ñ‹ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ, Ñ‚.Ðº. Ñ‚Ð²Ð¾Ð¹ Ð¡Ð°Ð½Ñ‚Ð° ÐµÑ‰Ðµ Ð½Ðµ Ð½Ð°ÑˆÑ‘Ð»ÑÑ.')


def sent(update: Update, context: CallbackContext):
    relation = RelationShip.select().where(RelationShip.donor == Person.get_by_id(update.effective_chat.id))
    if relation.exists():
        relation = relation[0]
    else:
        context.bot.send_message(chat_id=update.effective_chat.id, text='Ð¢Ñ‹ Ð½Ðµ ÑÐ²Ð»ÑÐµÑˆÑŒÑÑ Ð¡Ð°Ð½Ñ‚Ð¾Ð¹ Ð¸ Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÑÑ‚Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ.\n\n...Ñ‚Ð¾Ñ‡Ð½ÐµÐµ Ð¼Ð¾Ð¶ÐµÑˆÑŒ, Ð½Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´Ñ‘Ñ‚, Ð¾Ñ…Ð¾Ñ…Ð¾')
        return
    donor = relation.donor
    context.bot.send_message(chat_id=donor.id, text='Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ñ‚Ñ€ÑƒÐ´Ð¸Ð»ÑÑ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð» Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº!\n\nÐ¯ Ð½Ð°Ð¿Ð¸ÑˆÑƒ Ñ‚ÐµÐ±Ðµ, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ð°ÐºÐ¾Ð½ÐµÑ†-Ñ‚Ð¾ Ð½Ð°Ð¹Ð´Ñ‘Ñ‚ ÐµÐ³Ð¾ Ð¿Ð¾Ð´ Ñ‘Ð»Ð¾Ñ‡ÐºÐ¾Ð¹. Ð˜Ð»Ð¸ ÐºÑƒÐ´Ð° Ñ‚Ð°Ð¼ Ñ‚Ñ‹ ÐµÐ³Ð¾ ÑÐ¿Ñ€ÑÑ‚Ð°Ð»..? :)')
    recipient = relation.recipient
    context.bot.send_message(chat_id=recipient.id, text='Ð¢Ð²Ð¾Ð¹ Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº Ð±Ñ‹Ð» Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½!\nÐ¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð½Ð°Ð¹Ñ‚Ð¸ ÐµÐ³Ð¾, ÑƒÐ»Ñ‹Ð±Ð½ÑƒÑ‚ÑŒÑÑ Ð¸ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ /received, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´Ð°Ñ‚ÑŒ Ð¿Ð¾Ð½ÑÑ‚ÑŒ Ð¡Ð°Ð½Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð²ÑÑ‘, Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾!')

